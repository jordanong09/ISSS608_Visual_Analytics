---
title: "Take-Home Exercise 3"
description: |
  Putting Visual Analytics into Practical Use
author:
  - name: Ong Zhi Rong Jordan 
    url: https://example.com/norajones
date: "`r Sys.Date()`"
output: 
  distill::distill_article:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      include = TRUE,
                      warning = FALSE,
                      message = FALSE)

# Learn more about creating websites with Distill at:
# https://rstudio.github.io/distill/website.html

```

```{r include=FALSE}
packages = c('tidyverse', 'ggdist', 'ggridges',
             'patchwork', 'ggthemes', 'hrbrthemes',
             'ggrepel', 'ggforce', 'gridExtra')
for(p in packages){
  if(!require(p, character.only = T)){
    install.packages(p)
  }
  library(p, character.only = T)
}

```

``` {r}
financeJ <- read_csv(file = "rawdata/FinancialJournal.csv")
participantsD <- read_csv(file = "rawdata/Participants.csv")

head (financeJ)
head (participantsD)
```


``` {r}
financeJ$timestamp <- (strptime(financeJ$timestamp , "%Y-%m-%d"))

financeJ_1 <- financeJ %>% #load the financeJ data table
  group_by(category, timestamp)%>% 
  summarise(amount = round(sum(amount),2)) %>% #sum all the amount based on their ID and Category rounding off to 2 decimal place
  pivot_wider(names_from = "category",values_from = "amount") #%>% #pivot the table to have the categories in columns instead of rows
financeJ_1[is.na(financeJ_1)] = 0

financeJ_Final <- financeJ_1 %>%
  mutate(Expenses = Education + Food + Recreation + Shelter + RentAdjustment) %>%
  select(timestamp,Wage,Expenses)
head (financeJ_Final)
```

``` {r merge_participants}

age_group1 <- 18:25 #create a vector of age
age_group2 <- 26:30
age_group3 <- 31:35
age_group4 <- 36:40
age_group5 <- 41:45
age_group6 <- 46:50
age_group7 <- 51:55
age_group8 <- 56:60

participants_final <- participantsD %>%
  mutate (agegroup= case_when(
    age %in% age_group1 ~ "18-25",
    age %in% age_group2 ~ "26-30",
    age %in% age_group3 ~ "31-35",
    age %in% age_group4 ~ "36-40",
    age %in% age_group5 ~ "41-45",
    age %in% age_group6 ~ "46-50",
    age %in% age_group7 ~ "51-55",
    age %in% age_group8 ~ "56-60")) %>%
  select (participantId,agegroup)

finance_Part <- financeJ %>%
  group_by(participantId,category, timestamp)%>% 
  summarise(amount = round(sum(amount),2))

final <- merge(participants_final,finance_Part,by=c("participantId","participantId"),all.x=T)

final_T <- final %>%
  pivot_wider(names_from = "category",values_from = "amount")
final_T[is.na(final_T)] = 0

```

``` {r draw_line_graph}

financeJ_Final %>%
  ggplot(aes(x=timestamp, y = Expenses)) +
  geom_line(color="#69b3a2") +
  geom_hline(yintercept = mean(Expenses), color = "orange", size = 0.5) +
  theme_ipsum()
```